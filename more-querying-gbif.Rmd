---
title: "More Querying GBIF Data"
output: pdf_document
---

Your name here  
Assignment 3  
DSCI 245 / RNR 496B  
Due: February 8th, 2022  


## More Querying GBIF Data


### Learning objectives:
* Understand how to query GBIF data with spocc, using a variety of arguments.
* Learn how to create a derivative data set with fewer columns.  
* Learn how to combine data sets.  
* Succesfully create a csv file from a data set.  



### Querying data from GBIF with spocc  

Picking up from last week, we're going to dive back into querying data from GBIF (Global Biodversity Information Facility) using the spocc (SPecies OCCurrence) R package. First, let's load the spocc package using the library() function:


```{r}

library("spocc")

```


Now, let's revisit the "occ()" function. The documenation for this function is available here:

https://docs.ropensci.org/spocc/reference/occ.html

Let's start by revisiting how to run a basic query to get species occurrences from GBIF. The following example will gives us data from GBIF on Southern Black Widows (Latrodectus mactans):

```{r}

blackWidows<-occ(query='Latrodectus mactans', from="gbif", limit=1000)

blackWidows


```

One thing we didn't look at last week was the "View()" function. If you recall, occ() returns an "object", which is basically a series of hierarchical data containing various pieces of information. We can navigate the object using the "$" operator, but it's only really useful if we know how to navigate the object. So let's run "View()" on blackWidows, and see what we get:

```{r}

View(blackWidows)

```

You'll notice this opens up a new tab in RStudio, and shows us what's inside the object, and how to navigate it. You can see by clicking the various arrows that we can navigate to the data by this path: blackWidows$gbif$data$ Latrodectus_mactans

```{r}

bwData<-blackWidows$gbif$data$Latrodectus_mactans

bwData

```


YOUR TURN:

* Query GBIF using the occ() function for 1000 Monarch butterflies (Danaus plexippus). 
* Use the View() function to see the object hierarchy.
* Create a variable to target the dataset from the object, and print it to the screen.


```{r}

# Create a variable set to the initial occ() query


# Use View() to see the object result


# Create another variable to target the data set, and then print to screen



```


### Further refining GBIF queries

The occ() function has many arguments to help refine our query. One particularly useful argument is "gbifopts", which provides a number of additional arguments specific to GBIF queries (remember, occ() can query multiple data sources...each one has their own 'opts' argument). 


We can look at all the possibilities for "gbifopts" by running the following:

```{r}
occ_options('gbif')
```

You can contain gbifopts in an R "list". The syntax for using a list is:

list(key1="value1", key2="value2")

Below I'm refining the query for the Southern Black Widow to just those in Texas during the year 2020:

```{r}

bwTx<-occ(query="Latrodectus mactans", from="gbif", gbifopts = list(stateProvince="Texas", year="2020"))

bwTx

```

YOUR TURN:

Refine your query to just return Monarch butterflies from Arizona in the years 2020 and 2021 (hint: refer to occ_options('gbif') to determine how to query multiple years):

```{r}

# Run the occ() query


# use View() to see the object


# Define a new variable, and print to the screen.



```




### Analyzing your data


Looking at the output of the data, it's safe to say that there are many columns that we simply don't need. While they don't hurt anything, it might be easier to work with if we can pare down the size of our data set...at least in terms of columns.





